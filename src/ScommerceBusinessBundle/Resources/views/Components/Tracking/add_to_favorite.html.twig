{#ovo je specifican event i postoji samo u GA4. implementiran (overajdan ovaj template) na encianu#}
{#{% apply spaceless %}#}
{#    {% if product is defined %}#}
{#        {% set product_title = get_entity_store_attribute(current_store_id,product,"name")|striptags %}#}

{#        {% set brand = get_product_attribute_value_by_key(product, 'brand') %}#}
{#        {% set brandName = '' %}#}
{#        {% if brand is not empty %}#}
{#            {% set brandName = brand.values[0].value|striptags %}#}
{#        {% endif %}#}

{#        {% set prices = render(controller('ScommerceBusinessBundle:Price:getProductPrices', {'product':product,'options':data.configurable_bundle|default({})}, {}))|json_decode %}#}

{#        {% set listTrackingData = app.request.cookies.get("list_tracking")|json_decode(constant('JSON_OBJECT_AS_ARRAY'))["product-" ~ product.getId]|default("") %}#}

{#        {% set trackingCode %}#}
{#            <script>#}
{#                window.dataLayer = window.dataLayer || [];#}
{#                window.dataLayer.push({#}
{#                    'event': 'ga4_add_to_wishlist',#}
{#                    'ecommerce': {#}
{#                        'items': [#}
{#                            {#}
{#                                'item_id': '{{ product.getId }}',#}
{#                                'item_name': '{{ product_title }}',#}
{#                                'price': {{ price|number_format(2,".","") }},#}
{#                                'currency': '{{ get_env("CURRENT_CURRENCY_CODE") }}',#}
{#                                'discount': {% if prices.discount_price is not empty %}{{ (prices.price-prices.discount_price)|number_format(2, '.', '') }}{% else %}0.00{% endif %},#}
{#                                'item_brand': '{{ brandName }}',#}
{#                                {% for item in get_menu_tree_for_product(product) %}#}
{#                                'item_category{% if loop.index > 1 %}{{ loop.index }}{% endif %}': '{{ item|striptags }}',#}
{#                                {% endfor %}#}
{#                                'item_list_name': '{{ listTrackingData["list_name"]|default("")|striptags }}',#}
{#                                'item_list_id': '{{ listTrackingData["list_id"]|default("") }}',#}
{#                                'index': {{ listTrackingData["list_index"]|default(0) }},#}
{#                                'quantity': 1#}
{#                            }#}
{#                        ]#}
{#                    }#}
{#                });#}
{#            </script>#}
{#        {% endset %}#}
{#         Cisto da se kod formatira u phpstormu, ali za execute ne trebaju script tagovi #}
{#        {{ trackingCode|striptags|raw }}#}
{#    {% endif %}#}
{#{% endapply %}#}