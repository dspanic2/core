$.extend({postFormSave:function(e,t){}}),jQuery(document).ready(function($){var lookupField=$('[data-type="lookup"]'),formRemoveItem=$("button.form-remove-item"),checkboxToggler=$('input[type="checkbox"]'),optionallyRequiredGroup=$(".optionally-required-group");if(optionallyRequiredGroup.length){var checkOptionallyRequiredGroup=function(){optionallyRequiredGroup.each(function(){var e=!1;$(this).find("input:not([type='hidden']), select").each(function(){0==$(this).val().length||(e=!0)}),e?(optionallyRequiredGroup.find("input:not([type='hidden']), select").prop("required",!0),optionallyRequiredGroup.find('[name="is_legal_entity"]').length&&optionallyRequiredGroup.find('[name="is_legal_entity"]').val(1)):(optionallyRequiredGroup.find("input:not([type='hidden']), select").prop("required",!1),optionallyRequiredGroup.find('[name="is_legal_entity"]').length&&optionallyRequiredGroup.find('[name="is_legal_entity"]').val(0))})};checkOptionallyRequiredGroup(),optionallyRequiredGroup.find("input:not([type='hidden']), select").on("input",function(){checkOptionallyRequiredGroup()})}formRemoveItem.on("click",function(e){e.preventDefault();var t=$(this).closest("form");t.find('[name="remove"]').val(1),t.trigger("submit")}),$(document).on("change",'input[type="checkbox"][data-toggle]',function(){if($(this).data("toggle")){var e=$("#"+$(this).data("toggle"));$(this).is(":checked")?(e.slideDown(),e.removeClass("optional")):(e.slideUp(),e.addClass("optional"))}}),lookupField.length&&lookupField.each(function(){$.initializeLookup($(this))}),$.extend({initializeFrontendForm:function(){$("form:not(.initialized),.form:not(.initialized)").each(function(){var form=$(this);if(form.find('[data-type="lookup"]').each(function(){$.initializeLookup($(this))}),form.find('[data-type="ckeditor"]').each(function(){$.initializeCkeditor($(this))}),$.initializeDatetimepicker(),$.createCustomCheckboxes(),$(this).hasClass("ajax-submit"))$(this).on("submit",function(event){var form=$(this);event.preventDefault(),$.initRecaptcha(function(){if($.formIsValid(form)){form.find("[data-presubmit-populate]").each(function(){var field=$(this),value=eval(field.data("presubmit-populate"));field.val(value)});var formData=new FormData(form[0]);form.find("input[type=checkbox]").each(function(e,t){formData.append($(t).attr("name"),$(this).is(":checked")?1:0)});var destinationParam=$.getUrlParam("destination");0!==destinationParam&&formData.append("destination",destinationParam),$.showAjaxLoader(),$.ajax({url:form.attr("action"),method:"POST",data:formData,cache:!1,contentType:!1,processData:!1}).done(function(e){if($.hideAjaxLoader(),0==e.error){if(form.addClass("submitted"),$.disableOverlays(form),e.message&&$.growl.notice({title:e.title?e.title:"",message:e.message?e.message:""}),e.content&&form.html('<span class="submitted">'+e.content+"</span>"),e.html&&form.data("replace")&&(1===form.data("set-html")?$(form.data("replace")).html(e.html):$(form.data("replace")).replaceWith(e.html)),form.data("replace-pieces")){var t=form.data("replace-pieces").split("|");$.each(t,function(t,i){var o=i.split("->");null!=e[o[0]]&&$(o[1]).length>0?$(o[1]).replaceWith(e[o[0]]):console.log("Wrong replace parameters!")})}if(form.data("trigger-action")&&$(document).trigger(form.data("trigger-action"),[form.serializeAssoc(),form,e]),e.redirect_url&&(window.location.href=e.redirect_url),e.reload&&$.reloadPage(),0!=$("body.page-dashboard_profile").length||form.hasClass("keep-values")||(form.find("input").not(".keep-value, :input[type=button], :input[type=submit], :input[type=reset], :input[type=checkbox], :input[type=radio]").val(""),form.find("textarea").val("")),"favorite"==form.attr("id")){var i=$("header .favorites .amount");i.length&&(i.show(),i.html(e.count))}form.parents(".overlay.active").length>0&&form.parents(".overlay.active").removeClass("active"),$.postFormSave(form,e)}else $.growl.error({title:e.title?e.title:"",message:e.message?e.message:""}),form.find('[name="remove"]').length&&form.find('[name="remove"]').val(0);null!=e.open_login_modal&&e.open_login_modal&&$(document).trigger("modal:login")})}else $.growl.error({title:translations.form_invalid_title,message:translations.form_invalid_message})})});else{var formMethod=$(this).attr("method");void 0!==formMethod&&"get"===formMethod.toLowerCase()&&$(this).on("submit",function(){return $(this).find(":input").filter(function(){return!this.value}).attr("disabled","disabled"),!0})}$(this).addClass("initialized")})}}),$.initializeFrontendForm(),$(document).on("change",".form-error",function(){$(this).removeClass("form-error")})});
