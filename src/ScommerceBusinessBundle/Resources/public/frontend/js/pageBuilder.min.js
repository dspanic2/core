function pageBuilderShowUploadFileType(e){var t=$(e).closest(".form-group").find(".images-preview");t.html(""),$.each(e.files,function(e,a){"image/jpeg"!==a.type&&"image/jpg"!==a.type&&"image/png"!==a.type&&"image/webp"!==a.type||$("<img>").attr("src",URL.createObjectURL(a)).appendTo(t)})}function loadURLToInputFiled(e){var t=e.data("prepopulate").toString().split(";"),a=e.data("filename").toString().split(";");let o=new DataTransfer;document.querySelector("#"+e.attr("id")).files=o.files,$.each(t,function(t,i){getImgURL(i,i=>{let l=a[t],n=new File([i],l,{type:"image/jpeg",lastModified:(new Date).getTime()},"utf-8");o.items.add(n),document.querySelector("#"+e.attr("id")).files=o.files,e.trigger("change")})})}function getImgURL(e,t){var a=new XMLHttpRequest;a.onload=function(){t(a.response)},a.open("GET",e),a.responseType="blob",a.send()}jQuery.extend({initializeSortable:function(){$(".builder-blocks").length>0&&$(".builder-blocks, .builder-blocks .columns").sortable({connectWith:[".builder-blocks",".builder-blocks .columns"],cursor:"move",tolerance:"intersect",opacity:.4,items:">[data-block-id]",distance:20,start:function(e,t){$("body").addClass("page-builder-sorting")},stop:function(e,t){$("body").removeClass("page-builder-sorting");var a=$.pageBuilderSavePositions($(".builder-blocks"));$.ajax({url:"/api/page_builder_save_positions",method:"POST",data:{data:a},cache:!1}).done(function(e){$.hideAjaxLoader(),!1===e.error?console.log("Saved..."):$.growl.error({title:e.title?e.title:"",message:e.message?e.message:translations.selection_error})})}}).disableSelection()},refreshSortable:function(){$(".builder-blocks, .builder-blocks .columns").sortable("refresh")},startPageBuilder:function(e){$.showAjaxLoader();var t={};void 0!==e&&(t.block=e),$.ajax({url:"/api/page_builder_get_settings",method:"POST",data:t,cache:!1}).done(function(e){0==e.error?($("#page-builder").length?$("#page-builder").replaceWith(e.html):$(".main-content").append(e.html),$("body").addClass("page-builder-active"),$('[type="file"][data-prepopulate]').length>0&&$('[type="file"][data-prepopulate]').each(function(){loadURLToInputFiled($(this))}),$(".is-admin.sp-block-outer:not(.page-builder-on)").each(function(){$(this).removeClass("is-admin").find(".sp-frontend-edit-block-wrapper").remove()}),$(".is-admin.sp-block-outer").each(function(){if(0==$(this).find(".move-block-settings").length){var e=$("<ul>").addClass("move-block-settings"),t=$("<li>").attr("title",translations.page_builder_up).addClass("move-block-setting up").html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 15L12 9L6 15" stroke="#000" stroke-linecap="round"/></svg>'),a=$("<li>").attr("title",translations.page_builder_up).addClass("move-block-setting down").html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9L12 15L18 9" stroke="#000" stroke-linecap="round"/></svg>');e.append(t),e.append(a),$(this).append(e)}if(0==$(this).find(".between-block-settings").length){var o=$("<ul>").addClass("between-block-settings"),i=$("<li>").attr("title",translations.page_builder_add_before).addClass("between-block-setting add").html('<span class="icons-vertical"><svg role="img" xmlns="http://www.w3.org/2000/svg" width="1000mm" height="1000mm" viewBox="0 0 1000 1000" style="max-width:1.6em; height: auto;"><path id="path" style="opacity:1;vector-effect:none;fill:#000000;fill-opacity:1;" d=" M 499 476C 508 476 518 480 525 487C 525 487 825 787 825 787C 840 801 840 825 825 840C 810 855 786 855 772 840C 772 840 498 566 498 566C 498 566 225 840 225 840C 210 855 186 855 171 840C 156 825 157 801 172 787C 172 787 472 487 472 487C 479 480 488 476 498 476C 498 476 498 476 499 476C 499 476 499 476 499 476M 500 149C 500 149 500 149 500 149C 510 149 520 153 527 160C 527 160 827 460 827 460C 842 474 842 498 827 513C 812 528 788 528 773 513C 773 513 500 239 500 239C 500 239 227 513 227 513C 212 528 188 528 173 513C 158 498 158 474 173 460C 173 460 473 160 473 160C 480 153 490 149 499 149C 500 149 500 149 500 149C 500 149 500 149 500 149" transform=""></path></svg><svg style="width: 15px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"/></svg></span>');o.append(i),$(this).append(o)}if($(this).hasClass("sp-block-outer-container")&&0==$(this).find(".left-block-settings").length){var l=$("<ul>").addClass("left-block-settings"),n=$("<li>").attr("title",translations.page_builder_add_to_container).addClass("left-block-setting add").html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 12H4" stroke="#676767" stroke-linecap="round"/><path d="M12 4V20" stroke="#676767" stroke-linecap="round"/></svg>');l.append(n),$(this).append(l)}}),$.initializeSortable()):$.growl.error({title:e.title?e.title:"",message:e.message?e.message:translations.selection_error})})},pageBuilderSavePositions:function(e){var t={};return e.hasClass("builder-blocks")?(t.type="builder_blocks",t.id=null):t.type="container",t.items=[],e.find(">.ui-sortable-handle").each(function(){var e={};e.id=$(this).data("block-id"),e.type=$(this).data("block-type"),$(this).find(">.ui-sortable").length>0?$(this).find(">.ui-sortable").each(function(){e.items=$.pageBuilderSavePositions($(this))}):$(this).find(">.sp-block-outer-container>.ui-sortable").length>0&&$(this).find(">.sp-block-outer-container>.ui-sortable").each(function(){e.items=$.pageBuilderSavePositions($(this))}),t.items.push(e)}),t.items.length>0?e.hasClass("builder-blocks")?t:t.items:null},pageBuilderRemoveBlock:function(e){$.showAjaxLoader();var t={};void 0!==e&&(t.block=e),$.ajax({url:"/api/page_builder_remove_block",method:"POST",data:t,cache:!1}).done(function(t){$.hideAjaxLoader(),0==t.error?($.startPageBuilder(),$(".builder-blocks").length>0?$('[data-block-id="'+e+'"]').remove():$('[data-block-id="'+e+'"]').parent().remove()):$.growl.error({title:t.title?t.title:"",message:t.message?t.message:translations.selection_error})})},pageBuilderMoveBlock:function(e,t,a){$.showAjaxLoader();var o={};o.block=e,o.direction=t,o.parentBlockId=a,$.ajax({url:"/api/page_builder_move_block",method:"POST",data:o,cache:!1}).done(function(a){if($.hideAjaxLoader(),0==a.error){$.startPageBuilder();var o=$('[data-block-id="'+e+'"]').parent();$(".builder-blocks").length>0&&(o=$('[data-block-id="'+e+'"]')),1===t?o.insertBefore(o.prev()):2===t&&o.insertAfter(o.next())}else $.growl.error({title:a.title?a.title:"",message:a.message?a.message:translations.selection_error})})},pageBuilderRemoveImage:function(e){$.showAjaxLoader();var t=e.data("id"),a={};a.id=t,$.ajax({url:"/api/page_builder_remove_image",method:"POST",data:a,cache:!1}).done(function(a){$.hideAjaxLoader(),0==a.error?(e.closest(".image").remove(),$(".page-gallery").find('[data-image="'+t+'"]').remove()):$.growl.error({title:a.title?a.title:"",message:a.message?a.message:translations.selection_error})})}}),jQuery(document).ready(function(e){e.startPageBuilder(),e(document).on("page-builder-new-block",function(t){e(".between-block-setting.add.between-active").length>0&&e("#page-builder").find('[name="before_block"]').val(e(".between-block-setting.add.between-active").closest(".is-admin.sp-block-outer").parent().data("block-id")),e(".left-block-setting.add.left-active").length>0&&e("#page-builder").find('[name="to_container"]').val(e(".left-block-setting.add.left-active").closest(".is-admin.sp-block-outer").parent().data("block-id"))}),e(document).on("reset-page-builder",function(t,a,o,i){if(e.startPageBuilder(),e(".between-block-setting.add.between-active").removeClass("between-active"),e(".left-block-setting.add.left-active").removeClass("left-active"),1==i.is_new&&null==i.to_container){var l=e("<div>").addClass("row"),n=e("<div>").addClass("col-xs-12").attr("data-block-id",i.block_id).attr("data-block-type",i.block_type);if(n.html(i.html),e(".builder-blocks").length>0?l=n:l.append(n),a.before_block)e(".builder-blocks").length>0?e('[data-block-id="'+a.before_block+'"]').before(l):e('[data-block-id="'+a.before_block+'"]').parent().before(l);else if(e(".builder-blocks").length>0)e(".builder-blocks").append(l);else{var s=e(".is-admin.sp-block-outer").last();s.length>0?s.parent().parent().after(l):e.reloadPage()}}else void 0!==i.to_container&&e('[data-block-id="'+i.to_container+'"]').html(i.html);e.refreshSortable()}),e(document).on("click","body.page-builder-active button.page-builder-cancel",function(t){t.preventDefault(),e.startPageBuilder()}),e(document).on("click","body.page-builder-active .is-admin.sp-block-outer",function(t){t.preventDefault(),t.stopImmediatePropagation(),e.startPageBuilder(e(this).parent().data("block-id"))}),e(document).on("click","body.page-builder-active .page-builder-remove-block",function(t){t.preventDefault();var a=e(this).data("block-id");e.confirm({title:translations.delete_block,content:"",buttons:{confirm:{text:translations.yes,btnClass:"button btn-type-1",keys:["enter"],action:function(){e.pageBuilderRemoveBlock(a)}},cancel:{text:translations.no,btnClass:"button btn-type-2",action:function(){}}}})}),e(document).on("click",".move-block-setting.up",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).closest(".sp-block-outer").parent();e.pageBuilderMoveBlock(a.data("block-id"),1,a.closest(".sp-block-outer-container").length>0?a.closest(".sp-block-outer-container").parent().data("block-id"):0)}),e(document).on("click",".move-block-setting.down",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).closest(".sp-block-outer").parent();e.pageBuilderMoveBlock(a.data("block-id"),2,a.closest(".sp-block-outer-container").length>0?a.closest(".sp-block-outer-container").parent().data("block-id"):0)}),e(document).on("click",".between-block-setting.add",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).hasClass("between-active");e(".between-block-setting.add.between-active").removeClass("between-active"),e("#page-builder").find('[name="before_block"]').val(""),a||(e(this).addClass("between-active"),e("#page-builder").find('[name="before_block"]').val(e(this).closest(".is-admin.sp-block-outer").parent().data("block-id")))}),e(document).on("click",".left-block-setting.add",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).hasClass("left-active");e(".left-block-setting.add.left-active").removeClass("left-active"),e("#page-builder").find('[name="to_container"]').val(""),a||(e(this).addClass("left-active"),e("#page-builder").find('[name="to_container"]').val(e(this).closest(".is-admin.sp-block-outer").parent().data("block-id")))}),e(document).on("click",".form-group.images .remove",function(t){t.preventDefault(),t.stopPropagation(),e.pageBuilderRemoveImage(e(this))})});
