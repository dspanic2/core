const formatter=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});jQuery.extend({updateCartNoButton:function(t){return!1},addToCart:function(t){var e=t.serializeArray(),a=t.parents(".product-information").find(".configuration");if(a.length){var r=[];a.find(".option.active").each(function(){$(this).data("option-id")&&r.push($(this).data("option-id")),$(this).data("frame")&&r.push($(this).data("frame")),$(this).data("lens")&&r.push($(this).data("lens"))}),e.push({name:"configurable",value:JSON.stringify(r)})}var i=t.parents(".product-details").find(".configurable-bundle-grid");if(i.length){var o={};i.find(".item").each(function(){var t=$(this).data("option-id"),e=$(this).find(".cb-selected").data("pid");o[t]={product_id:e}}),e.push({name:"configurable_bundle",value:JSON.stringify(o)})}if(t.hasClass("bundle-cart")){var l=t.parents(".bundle-row"),c=[];l.find(".bundle-item-select").each(function(){$(this).is(":checked")&&c.push($(this).data("pid"))}),e.push({name:"bundle",value:JSON.stringify(c)})}$.showAjaxLoader(),$.ajax({url:t.attr("action"),method:"POST",data:$.param(e),cache:!1}).done(function(e){if($.hideAjaxLoader(),0==e.error){t.parent().hasClass("product-display-grid")?$(document).trigger("tracking:add_to_cart",t.parent()):t.parents(".product-details").length&&$(document).trigger("tracking:add_to_cart_from_details");var a=e.message?e.message:"";if(a+="<br>",a+='<a href="'+urls.cart.url+'" class="button btn-type-1">'+urls.cart.title+"</a>",a+='<button class="growl-button button  btn-type-2">'+translations.continue+"</button>",$.growl.notice({title:e.title?e.title:"",message:a}),$("#cart-display").length&&$("#cart-display").replaceWith(e.minicart_html),$(".cart-toggle").length){$(".cart-toggle").removeClass("active");var r=Math.ceil(e.minicart_num);$(".cart-toggle").find(".amount").html(r),r<1?$(".cart-toggle").find(".amount").hide():$(".cart-toggle").find(".amount").show()}$(".cart-toggle").find(".info .price-value").length?$(".cart-toggle").length&&e.total_price&&(e.total_price=e.total_price.replaceAll(",","."),$(".cart-toggle .info .price-value strong").html(formatter.format(parseFloat(e.total_price))),$(".cart-toggle .info .price-value.euro strong").length&&$("#conversion-rate").length&&$(".cart-toggle .info .price-value.euro strong").html(formatter.format(parseFloat(e.total_price)/$("#conversion-rate").data("rate")))):$(".cart-toggle").find(".info").append(e.price_html),t.parents(".cart-add-reload-page").length&&$(document).trigger("global:page-reload"),void 0!==e.total_price&&$(".mini-cart-total .price-value").text(e.total_price)}else $.growl.error({title:e.title?e.title:"",message:e.message?e.message:""})})},removeAllItemsFromCart:function(t,e){void 0===e&&(e=!1);var a=$("#cart-display").hasClass("active");$.showAjaxLoader(),$.ajax({url:"/cart/remove_all_items_from_cart",method:"POST",cache:!1}).done(function(r){if($.hideAjaxLoader(),0==r.error){$.growl.notice({title:r.title?r.title:"",message:r.message?r.message:""});var i=t.parents(".minicart-inner").length>0;t.parent().remove();var o=$(r.minicart_html);if(i&&o.addClass("active"),$("#cart-display").replaceWith(o),a&&($("#cart-display").addClass("active"),$(".cart-toggle").addClass("active")),$(".cart-toggle").length){var l=Math.ceil(r.minicart_num);$(".cart-toggle").find(".amount").html(l),l<1?$(".cart-toggle").find(".amount").hide():$(".cart-toggle").find(".amount").show()}0==$("#cart").find(".product-display-grid").length&&$("#cart").remove(),void 0!==r.total_price&&$(".mini-cart-total .price-value").text(r.total_price),void 0!==r.cart_html&&$("#cart").length&&0==$("#cart").parents(".dashboard-element").length&&$("#cart").replaceWith(r.cart_html),void 0!==r.gifts_html&&$("#cart-gifts").length&&$("#cart-gifts").replaceWith(r.gifts_html),$(".cart-toggle").find(".info .price-value").length&&$(".cart-toggle").length&&r.total_price&&(r.total_price=r.total_price.replaceAll(",","."),$(".cart-toggle .info .price-value strong").html(formatter.format(parseFloat(r.total_price))),$(".cart-toggle .info .price-value.euro strong").length&&$("#conversion-rate").length&&$(".cart-toggle .info .price-value.euro strong").html(formatter.format(parseFloat(r.total_price)/$("#conversion-rate").data("rate")))),$.loadLazyImages(),e&&$.reloadPage()}else $.growl.error({title:r.title?r.title:"",message:r.message?r.message:""})})},removeItemFromCart:function(t,e){void 0===e&&(e=!1);var a=$("#cart-display").hasClass("active"),r={};r.product_id=t.data("product-id"),t.data("quote-item-id")&&(r.quote_item_id=t.data("quote-item-id")),$.showAjaxLoader(),$.ajax({url:"/cart/remove_from_cart",method:"POST",data:r,cache:!1}).done(function(r){if($.hideAjaxLoader(),0==r.error){if($.growl.notice({title:r.title?r.title:"",message:r.message?r.message:""}),t.parent().remove(),$("#cart-display").replaceWith(r.minicart_html),$(".cart-toggle").length){$(".cart-toggle").removeClass("active");var i=Math.ceil(r.minicart_num);$(".cart-toggle").find(".amount").html(i),i<1?$(".cart-toggle").find(".amount").hide():$(".cart-toggle").find(".amount").show()}0==$("#cart").find(".product-display-grid").length&&$("#cart").remove(),a&&($("#cart-display").addClass("active"),$(".cart-toggle").addClass("active")),$(".cart-toggle").find(".info .price-value").length&&$(".cart-toggle").length&&r.total_price&&(r.total_price=r.total_price.replaceAll(",","."),$(".cart-toggle .info .price-value strong").html(formatter.format(parseFloat(r.total_price))),$(".cart-toggle .info .price-value.euro strong").length&&$("#conversion-rate").length&&$(".cart-toggle .info .price-value.euro strong").html(formatter.format(parseFloat(r.total_price)/$("#conversion-rate").data("rate")))),void 0!==r.total_price&&$(".mini-cart-total .price-value").text(r.total_price),e&&$.reloadPage()}else $.growl.error({title:r.title?r.title:"",message:r.message?r.message:""})})},updateCart:function(t){var e=[];t.parents(".cart-items").find("form.item-cart").each(function(){e.push($(this).serializeArray())});var a=$("#cart-display").hasClass("active");$.showAjaxLoader(),$.ajax({url:"/cart/update_cart",method:"POST",data:{data:e},cache:!1}).done(function(e){if($.hideAjaxLoader(),0==e.error){if($.growl.notice({title:e.title?e.title:"",message:e.message?e.message:""}),t.parents(".minicart-inner").length>0&&$("#cart-display").addClass("active"),$("#cart-display").replaceWith(e.minicart_html),a&&($("#cart-display").addClass("active"),$(".cart-toggle").addClass("active")),$(".cart-toggle").length){var r=Math.ceil(e.minicart_num);$(".cart-toggle").find(".amount").html(r),r<1?$(".cart-toggle").find(".amount").hide():$(".cart-toggle").find(".amount").show()}0==$("#cart").find(".product-display-grid").length&&$("#cart").remove(),void 0!==e.total_price&&$(".mini-cart-total .price-value").text(e.total_price),void 0!==e.cart_html&&$("#cart").length&&$("#cart").replaceWith(e.cart_html),void 0!==e.gifts_html&&$("#cart-gifts").length&&$("#cart-gifts").replaceWith(e.gifts_html),void 0!==e.total_price&&$(".mini-cart .cart-amount-price .total-value").length&&$(".mini-cart .cart-amount-price .total-value").html(e.total_price),$(".cart-toggle").find(".info .price-value").length&&$(".cart-toggle").length&&e.total_price&&(e.total_price=e.total_price.replaceAll(",","."),$(".cart-toggle .info .price-value strong").html(formatter.format(parseFloat(e.total_price))),$(".cart-toggle .info .price-value.euro strong").length&&$("#conversion-rate").length&&$(".cart-toggle .info .price-value.euro strong").html(formatter.format(parseFloat(e.total_price)/$("#conversion-rate").data("rate")))),$.initializeFrontendForm()}else $.growl.error({title:e.title?e.title:"",message:e.message?e.message:""})})}}),jQuery(document).ready(function(t){t(document).on("click",".minicart-update-cart, .update-cart, #update-cart",function(){t.updateCart(t(this))}),t(document).on("click",".cart-remove-item",function(){var e=!1;t(this).parents("#cart").length&&(e=!0),t.removeItemFromCart(t(this),e)}),t(document).on("click",".items-remove-all",function(){var e=!1;t(this).parents("#cart").length&&(e=!0),t.removeAllItemsFromCart(t(this),e)}),t(document).on("submit","form.item-cart",function(e){e.preventDefault(),e.stopImmediatePropagation(),t.addToCart(t(this))}),t(document).on("click",".qty-minus",function(e){e.preventDefault(),e.stopImmediatePropagation();var a=t(this).closest(".item-cart").find("input.qty"),r=1;a.data("step")&&(r=parseFloat(a.data("step")));var i=parseFloat(a.val()),o=parseFloat(a.attr("min"));if(i>o){var l=i-r;l=l%1==0?parseInt(l):parseFloat(l).toFixed(2),a.val(l),t.updateCartNoButton()&&(t(this).parents(".minicart-inner").length>0?t(this).closest(".minicart-inner").find(".minicart-update-cart").click():t(this).parents(".items-grid.checkout-view").length>0&&t(this).closest(".cart-items").find("#update-cart").click())}else a.val(o);a.trigger("change")}),t(document).on("click",".qty-plus",function(e){e.preventDefault(),e.stopImmediatePropagation();var a=t(this).closest(".item-cart").find("input.qty"),r=1;a.data("step")&&(r=parseFloat(a.data("step")));var i=parseFloat(a.val())+r,o=parseFloat(a.attr("max"));i<=o?(i=i%1==0?parseInt(i):parseFloat(i).toFixed(2),a.val(i),a.trigger("change"),t.updateCartNoButton()&&(t(this).parents(".minicart-inner").length>0?t(this).closest(".minicart-inner").find(".minicart-update-cart").click():t(this).parents(".items-grid.checkout-view").length>0&&t(this).closest(".cart-items").find("#update-cart").click())):t.growl.warning({title:translations.max_value_warning_title,message:translations.max_value_warning_message+" "+parseFloat(o)+"<br>"+translations.max_value_warning_contact})}),t(document).on("change keyup","input.qty",function(){parseInt(t(this).val())>parseInt(t(this).attr("max"))&&t(this).val(t(this).attr("max"))}),t(document).on("click",".minicart-coupon-title,.cart-discount-title",function(e){e.preventDefault(),e.stopImmediatePropagation(),t(this).parent().find(".coupon-wrapper").slideToggle()}),t(document).on("click",".coupon-code-remove",function(e){e.preventDefault(),e.stopImmediatePropagation(),t.showAjaxLoader(),t.ajax({url:"/api/apply_coupon",method:"POST",data:{discount_coupon_name:"",step:t(".cart-step.current").data("step")},cache:!1}).done(function(e){t.hideAjaxLoader(),0==e.error?(void 0!==e.cart_html&&t("#cart").length&&t("#cart").replaceWith(e.cart_html),void 0!==e.minicart_html&&t("#cart-display").length&&t("#cart-display").replaceWith(e.minicart_html)):t.growl.error({title:e.title?e.title:"",message:e.message?e.message:""})})}),t(document).on("click",".product-gift-item .gift-select",function(){var e=t(this),a={};a.product_id=t(this).parent().data("product-id"),a.qty=1,t(this).parent().hasClass("selected")?(t.showAjaxLoader(),t.ajax({url:"/cart/remove_from_cart",method:"POST",data:a,cache:!1}).done(function(a){if(t.hideAjaxLoader(),0==a.error){t.growl.notice({title:a.title?a.title:"",message:a.message?a.message:""}),e.parent().removeClass("selected");var r=e.closest(".items-grid.grid-view");r.find(".product-gift-item.selected").length<r.data("available-gifts")&&r.hasClass("disabled")&&r.removeClass("disabled"),t(".used-gift-amount").text(parseInt(r.find(".product-gift-item.selected").length)),void 0!==a.cart_html&&t("#cart").length&&t("#cart").replaceWith(a.cart_html),void 0!==a.minicart_html&&t("#cart-display").length&&t("#cart-display").replaceWith(a.minicart_html),void 0!==a.total_price&&t(".mini-cart .cart-amount-price .total-value").length&&t(".mini-cart .cart-amount-price .total-value").html(a.total_price)}else t.growl.error({title:a.title?a.title:"",message:a.message?a.message:""})})):(t.showAjaxLoader(),t.ajax({url:"/cart/add_to_cart",method:"POST",data:a,cache:!1}).done(function(a){if(t.hideAjaxLoader(),0==a.error){t.growl.notice({title:a.title?a.title:"",message:a.message}),e.parent().addClass("selected");var r=e.closest(".items-grid.grid-view");r.find(".product-gift-item.selected").length==r.data("available-gifts")&&r.addClass("disabled"),t(".used-gift-amount").text(parseInt(r.find(".product-gift-item.selected").length)),void 0!==a.cart_html&&t("#cart").length&&t("#cart").replaceWith(a.cart_html),void 0!==a.minicart_html&&t("#cart-display").length&&t("#cart-display").replaceWith(a.minicart_html),void 0!==a.total_price&&t(".mini-cart .cart-amount-price .total-value").length&&t(".mini-cart .cart-amount-price .total-value").html(a.total_price)}else t.growl.error({title:a.title?a.title:"",message:a.message?a.message:""})}))})});
