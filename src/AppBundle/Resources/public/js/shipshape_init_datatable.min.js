var table_state={};function prepareAdvancedSearch(t,e){if(t.parents(".sp-block").find(".sp-search-wrapper-active").length){var a=t.parents(".sp-block").find(".sp-advanced-search"),r=[];a.find(".sp-search-item").each(function(t){var e={},a=null,i=null,n=null,l=jQuery(this).parents(".sp-search-group");if(jQuery(this).find('[data-multiple="true"]').length>0?(i=jQuery(this).find("select"),a=null,jQuery(this).find("select").val()&&(a=jQuery(this).find("select").val().join(",")),n=l.find('[name="search_type"]').val()):jQuery(this).find("input").length?(i=jQuery(this).find("input"),a=jQuery(this).find("input").val(),l.find('[name="search_type"]').length>0&&(n=l.find('[name="search_type"]').val())):(i=jQuery(this).find("select"),a=jQuery(this).find("select").val(),n=l.find('[name="search_type"]').val()),n||(n=jQuery(this).data("search_type")),a){e.value=a;var s={};s.attributeId=i.data("id"),s.data=i.attr("name"),s.search_type=n,s.search=e,r.push(s)}}),e.custom_data=JSON.stringify(r)}return!1}function prepareQuickSearch(t,e){if(t.parents(".sp-block").find(".sp-quick-search-wrapper").length){var a=t.parents(".sp-block").find(".sp-quick-search"),r=[];a.find(".sp-search-item").each(function(t){var e={},a=null,i=null;if(jQuery(this).find('[data-multiple="true"]').length>0?(i=jQuery(this).find("select"),a=null,jQuery(this).find("select").val()&&(a=jQuery(this).find("select").val().join(","))):jQuery(this).find("input").length?(i=jQuery(this).find("input"),a=jQuery(this).find("input").val()):(i=jQuery(this).find("select"),a=jQuery(this).find("select").val()),a){e.value=a;var n={};n.attributeId=i.data("id"),n.data=i.attr("name"),n.search_type=jQuery(this).data("search_type"),n.search=e,r.push(n)}}),e.quick_search_data=JSON.stringify(r)}}function fixedTableAfter(t,e){t.parents(".dataTables_wrapper");if(t.DataTable().columns.adjust(),t.parents(".sp-fixed-header").length>0){if(t.find("tbody tr").length>0){var a=t.find("td:not(.sp-actions-td)").width()+18;t.find("th:not(.sp-actions-td)").css({width:a+"px","min-width":a+"px","max-width":a+"px"})}t.find("thead").show()}return!1}jQuery.fn.extend({insertDatatableData:function(t){var e=jQuery(this);if(e.find("tbody").html(t.html),e.data("callback-after")){var a=e.data("callback-after");jQuery.each(a,function(a,r){window[r](e,t)})}return selectList&&selectList[e.attr("id")+"_wrapper"]&&(jQuery.each(selectList[e.attr("id")+"_wrapper"],function(t,a){jQuery.each(a,function(t,a){e.find('[data-select-id="'+a+'"]').length>0&&(e.find('[data-select-id="'+a+'"]').children("i").toggleClass("fa-square").toggleClass("fa-check-square"),e.find('[data-select-id="'+a+'"]').closest("tr").toggleClass("sp-row-active"))})}),e.parents(".sp-block").find(".sp-listview-dropdown-control").removeClass("hidden")),e.find('[data-action="popover-lite"]').length>0&&e.on("mouseenter",'[data-action="popover-lite"]',function(){jQuery(this).popover({html:!0,trigger:"hover",content:function(){return jQuery(this).data("html")},title:function(){return""},placement:"top"}),jQuery(this).popover("show")}),!1},setFilterHtml:function(){var t=jQuery(this).attr("id"),e='<tr class="sp-filter-holder">';return jQuery(this).find(".sp-table-header").length>0&&jQuery(this).find(".sp-table-header").children("th").each(function(a){e+="<th",jQuery(this).data("col-filter")&&(e=e+' id="sp-filter-holder-'+a+"_"+t+'" class="sp-filter"'),e+="></th>"}),e+="</tr>",jQuery(this).find(".sp-table-header").before(e),jQuery(this).find(".sp-filter-holder").find("th:last-child").addClass("sp-actions-td sp-actions-td-filer").html('<span class="sp-actions-td-inner"></span>'),jQuery(this).find(".sp-list-checkbox-td").length&&jQuery(this).find(".sp-filter-holder").find("th:first-child").addClass("sp-list-checkbox-td"),!1},setYFilterHtmlButtons:function(){return jQuery(this).parents(".dataTables_wrapper").find(".sp-buttons-holder").html(jQuery("#sp-filter-buttons-template").clone().children()),!1},createDatatable:function(){var table=jQuery(this),table_wrapper=jQuery(this).parent(),datatable_configuration={},datatable_header="<'row'<'col-xs-3'><'col-xs-3'><'col-xs-6 sp-buttons-holder'>r>t<'row'<'col-xs-3'i><'col-xs-9'p>>",aoColumns=[];if(table.find(".sp-table-header").length>0&&table.find(".sp-table-header").children("th").each(function(t){var e={};e.mDataProp=jQuery(this).data("col-name"),e.bSearchable=jQuery(this).data("col-search"),e.bSortable=jQuery(this).data("col-sort"),aoColumns.push(e)}),table.data("empty"))datatable_configuration={sDom:"t"};else if(datatable_configuration={stateSave:!0,sDom:datatable_header,sPaginationType:"bootstrap",pageLength:table.data("limit"),oLanguage:{sInfo:translations.showing+" _START_ "+translations.smallto+" _END_ "+translations.smallfrom+" _TOTAL_ "+translations.results,sInfoFiltered:"("+translations.filtered_from+" _MAX_ "+translations.totals+" "+translations.results+")",sInfoEmpty:translations.showing+" 0 "+translations.smallfrom+" 0 "+translations.results,sLengthMenu:"_MENU_ "+translations.records_per_page,sSearch:"",oPaginate:{sFirst:translations.sfrist,sPrevious:translations.sprevious,sNext:translations.snext,sLast:translations.slast}},lengthMenu:[[5,10,25,50,100,150],[5,10,25,50,100,150]]},aoColumns.length>0&&(datatable_configuration.aoColumns=aoColumns),table.data("f-columns")){datatable_configuration.scrollY="80vh",datatable_configuration.scrollX=!0,datatable_configuration.scrollCollapse=!0,datatable_configuration.fixedColumns={};var lcolumn=table.data("fl-column"),rcolumn=table.data("fr-column");jQuery.isNumeric(lcolumn)&&(datatable_configuration.fixedColumns.leftColumns=0),jQuery.isNumeric(rcolumn)&&(datatable_configuration.fixedColumns.rightColumns=rcolumn)}if(!1!==table.data("order-col")&&(datatable_configuration.order=[[table.data("order-col"),table.data("order-dir")]]),table.data("export")&&(datatable_configuration.buttons=[{extend:"excelHtml5",text:"Save current page",exportOptions:{modifier:{page:"current"}}}]),table.data("filter")&&!table.data("server")&&(table.setFilterHtml(),datatable_configuration.initComplete=function(t){this.api().columns().every(function(){var t=this,e=jQuery(t.header()).index(),a=jQuery(t.header()).closest("tr").prev().children().eq(e);if(!a.hasClass("sp-filter"))return!0;var r=jQuery('<select><option value=""></option></select>').appendTo(a).on("change",function(){var e=jQuery.fn.dataTable.util.escapeRegex(jQuery(this).val());t.search(e?"^"+e+"$":"",!0,!1).draw()});t.data().unique().sort().each(function(t,e){r.append('<option value="'+t+'">'+t+"</option>")})})}),table.data("filter")&&table.data("server")&&table.find(".sp-table-header").length>0){var filterData=[];table.setFilterHtml(),table.find(".sp-table-header").children("th").each(function(t){var e={};jQuery(this).data("col-filter")&&(e.column_number=t,e.filter_type=jQuery(this).data("filter-type"),e.filter_container_id="sp-filter-holder-"+t+"_"+table.attr("id"),e.style_class="form-control",e.filter_delay="300","multi_select"==jQuery(this).data("filter-type")?e.select_type="select2":"range_date"==jQuery(this).data("filter-type")?e.date_format=jQuery(this).data("date-format"):"range_number"==jQuery(this).data("filter-type")&&(jQuery(this).data("ignore-char")&&(e.ignore_char=jQuery(this).data("ignore-char")),e.column_data_type="rendered_html",e.html_data_type="text",jQuery(this).data("filter-plugin-options")&&(e.filter_plugin_options={step:jQuery(this).data("filter-plugin-options")})),"multi_select"!=jQuery(this).data("filter-type")&&"select"!=jQuery(this).data("filter-type")||(e.data=jQuery(this).data("list"),e.filter_default_label=translations.select_value),filterData.push(e))})}table.data("server")&&(datatable_configuration.processing=!0,datatable_configuration.serverSide=!0,datatable_configuration.serverData=function(source,request_data,fnCallback,settings){var send_data={};jQuery.each(request_data,function(t,e){send_data[e.name]=e,"columns"==e.name?jQuery.each(e.value,function(t,e){send_data.columns.value[t].search_type=table.find('[data-col-name="'+e.data+'"]').data("search-type")}):"order"==e.name&&(sortType=table.find('[data-col-name="'+send_data.columns.value[e.value[0].column].data+'"]').data("is_json"),"undefined"!==sortType&&(send_data.order.value[0].sort_type=sortType))});var inlineEditing=0;table.hasClass("sp-list-editable")&&(inlineEditing=1),send_data.edit=inlineEditing,send_data=JSON.stringify(send_data);var custom_data={};if(table.data("before")){var functions=table.data("before");jQuery.each(functions,function(key,f){eval("typeof "+f+" === 'function'")&&window[f](table,custom_data)})}table_state[table.attr("id")]={send_data:send_data,custom_data:custom_data.custom_data},settings.jqXHR=jQuery.ajax({dataType:"json",type:"POST",url:table.data("url"),data:{data:send_data,custom_data:custom_data.custom_data,quick_search_data:custom_data.quick_search_data},success:function(t){fnCallback(t),table.insertDatatableData(t),jQuery.setCookie("inline_editing_"+table.attr("id"),inlineEditing),table.find('[data-type="bchackbox"]').length&&table.find('[data-type="bchackbox"]').bootstrapSwitch(),jQuery("td .image-holder").length&&jQuery("td .image-holder").each(function(){if(jQuery(this).magnificPopup({delegate:"a",type:"image",tLoading:"Loading image #%curr%...",mainClass:"mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.'}}),jQuery(this).find(".dropzone").length>0&&jQuery(this).find(".dropzone").each(function(t){initializeDropzone(jQuery(this))}),jQuery(this).find(".sortable-items").length>0){var t=jQuery(this).find(".sortable-items");t.sortable({update:function(e,a){var r=[];jQuery.each(t.find('[name="image_sort_id[]"]'),function(t){r.push(jQuery(this).val())}),jQuery.showAjaxLoader(),jQuery.post(t.data("sortable_url"),{data:r,parent_id:t.data("parent_id"),entity_type_code:t.data("entity_type_code"),parent_attribute_id:t.data("parent_attribute_id")},function(t){jQuery.hideAjaxLoader(),0==t.error||jQuery.growl.error({title:translations.error_message,message:t.message})},"json")}})}}),table.find('[data-type="lookup"]').length>0&&table.find('[data-type="lookup"]').each(function(t){initializeLookup(jQuery(this),null)})}})});var filter=table.DataTable(datatable_configuration);return filterData&&(table.data("filter-buttons")?(yadcf.init(filter,filterData,{externally_triggered:!0}),table.setYFilterHtmlButtons()):yadcf.init(filter,filterData),table_wrapper.on("click",'[data-action="filter-submit"]',function(){yadcf.exFilterExternallyTriggered(filter)}),table_wrapper.parents(".panel").on("click",'[data-action="filter-reset"]',function(){yadcf.exResetAllFilters(filter)})),table.parent().addClass("table-responsive"),jQuery(".dataTables_filter input").length&&jQuery(".dataTables_filter input").addClass("form-control").attr("placeholder",translations.quick_search),jQuery(".dataTables_length select").length&&jQuery(".dataTables_length select").addClass("form-control"),table.data("export")&&jQuery(".dt-button").addClass("btn").addClass("btn-default").addClass("btn-sm"),!0}});
