var calendars={};function initializeTimepicker(t,a){return void 0===a&&(a=!0),t.timepicker({defaultTime:t.val(),template:!1,showInputs:!1,showMeridian:!1,minuteStep:1,secondStep:1,showSeconds:!0}),!0}function initializeDatesingle(t,a){void 0===a&&(a=!0);var e=t.val();return t.daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{firstDay:translations.firstDayNumber,cancelLabel:translations.Clear,format:"DD/MM/YYYY",monthNames:[translations.January,translations.February,translations.March,translations.April,translations.May,translations.June,translations.July,translations.August,translations.September,translations.October,translations.November,translations.December],monthNamesShort:[translations.Jan,translations.Feb,translations.Mar,translations.Apr,translations.May,translations.Jun,translations.Jul,translations.Aug,translations.Sep,translations.Oct,translations.Nov,translations.Dec],dayNames:[translations.Sunday,translations.Monday,translations.Tuesday,translations.Wednesday,translations.Thursday,translations.Friday,translations.Saturday],daysOfWeek:[translations.Sun,translations.Mon,translations.Tue,translations.Wed,translations.Thu,translations.Fri,translations.Sat]}}),a||e||t.val(""),!0}function initializeDateTimesingle(t,a){void 0===a&&(a=!0);var e=t.val();return t.daterangepicker({autoApply:!1,singleDatePicker:!0,showDropdowns:!0,timePicker:!0,timePickerIncrement:1,timePicker24Hour:!0,timePickerSeconds:!0,locale:{firstDay:translations.firstDayNumber,cancelLabel:translations.Clear,format:"DD/MM/YYYY HH:mm:ss",monthNames:[translations.January,translations.February,translations.March,translations.April,translations.May,translations.June,translations.July,translations.August,translations.September,translations.October,translations.November,translations.December],monthNamesShort:[translations.Jan,translations.Feb,translations.Mar,translations.Apr,translations.May,translations.Jun,translations.Jul,translations.Aug,translations.Sep,translations.Oct,translations.Nov,translations.Dec],dayNames:[translations.Sunday,translations.Monday,translations.Tuesday,translations.Wednesday,translations.Thursday,translations.Friday,translations.Saturday],daysOfWeek:[translations.Sun,translations.Mon,translations.Tue,translations.Wed,translations.Thu,translations.Fri,translations.Sat]}}),a||e||t.val(""),!0}function initializeDaterange(t,a,e){void 0===a&&(a=!0),void 0===e&&(e=!1);var r=t.val(),n={autoApply:!1,locale:{firstDay:translations.firstDayNumber,cancelLabel:translations.Clear,format:"DD/MM/YYYY",monthNames:[translations.January,translations.February,translations.March,translations.April,translations.May,translations.June,translations.July,translations.August,translations.September,translations.October,translations.November,translations.December],monthNamesShort:[translations.Jan,translations.Feb,translations.Mar,translations.Apr,translations.May,translations.Jun,translations.Jul,translations.Aug,translations.Sep,translations.Oct,translations.Nov,translations.Dec],dayNames:[translations.Sunday,translations.Monday,translations.Tuesday,translations.Wednesday,translations.Thursday,translations.Friday,translations.Saturday],daysOfWeek:[translations.Sun,translations.Mon,translations.Tue,translations.Wed,translations.Thu,translations.Fri,translations.Sat]}};return e&&(n.parentEl=t.parent()),t.daterangepicker(n),a||r||t.val(""),!0}function initializeDaterangeTime(t,a){void 0===a&&(a=!0);var e=t.val();return t.daterangepicker({autoApply:!1,timePicker:!0,timePickerIncrement:30,timePicker24Hour:!0,locale:{firstDay:translations.firstDayNumber,cancelLabel:translations.Clear,format:"DD/MM/YYYY H:mm",monthNames:[translations.January,translations.February,translations.March,translations.April,translations.May,translations.June,translations.July,translations.August,translations.September,translations.October,translations.November,translations.December],monthNamesShort:[translations.Jan,translations.Feb,translations.Mar,translations.Apr,translations.May,translations.Jun,translations.Jul,translations.Aug,translations.Sep,translations.Oct,translations.Nov,translations.Dec],dayNames:[translations.Sunday,translations.Monday,translations.Tuesday,translations.Wednesday,translations.Thursday,translations.Friday,translations.Saturday],daysOfWeek:[translations.Sun,translations.Mon,translations.Tue,translations.Wed,translations.Thu,translations.Fri,translations.Sat]}}),a||e||t.val(""),!0}function removeDatepicker(t){t.data("daterangepicker").remove()}function goBackWithRefresh(t){var a=sessionStorage.getItem("history");a&&(a=jQuery.parseJSON(a));var e=window.location.href;e&&(e=(e=(e=(e=e.split("?"))[0]).split("#"))[0]);for(var r=a.length-1;r>=0;r--){if(a[r]!=e){var n=a[r],i=sessionStorage.getItem("tab-"+$.hashCode(n));return void 0!==i&&i||!window.sessionStorage||(i=""),void(window.location=n+i)}a.splice(r,1)}return!1}function advanced_search(t,a){jQuery("#advanced-result-wrapper").html(a.html),jQuery("#"+jQuery("#advanced-result-wrapper").find(".datatables").attr("id")).createDatatable()}function exportMenuToJson(){jQuery("#btnOut").trigger("click")}function downloadFile(t,a){var e="";a.file?e=a.file:a.filepath&&(e=a.filepath);var r=window.open(e,"_blank");return!1===a.error?r?r.focus():alert("Please allow popups for this website"):jQuery.growl.error({title:translations.error_message,message:a.message}),!1}function showImportResults(t,a){return t.find(".sp-matching-container").hide(),t.find(".sp-results-container").html(a.html).show(),t.find(".btn-primary").hide(),jQuery("body").find(".datatables").each(function(t){jQuery(this).DataTable().ajax.reload(null,!1)}),!1}function gridstackSort(t,a){return t.y===a.y?t.x===a.x?0:t.x<a.x?-1:1:t.y<a.y?-1:1}function standardAddModalForm(url,button){jQuery.post(url,{},function(result){if(0==result.error){var clone=jQuery("#modal-container").clone(!0,!0).appendTo(jQuery("footer"));clone.html(result.html);var modal=clone.find(".modal");modal.modal("show"),modal.data("source_url",url);var form=modal.find('[data-validate="true"]');form.initializeValidation();var entity_type=form.data("type"),func=entity_type+"_modal_open";eval("typeof "+func+" === 'function'")&&window[func](form)}else jQuery.growl.error({title:translations.error_message,message:result.message});button&&button.prop("disabled",!1)},"json")}function getUrlAsAstring(){if(window.location.href.indexOf("?")>0){for(var t,a="?",e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<e.length;r++)a+=(t=e[r].split("="))[0]+"="+t[1];return a}return""}function custom(form,result){var custom_function=form.data("custom-callback");return jQuery.each(custom_function,function(key,f){eval("typeof "+f+" === 'function'")&&window[f](form,result)}),!1}function postSave(t,a){if(t.parents(".redirect-to-edit").length>0&&0==a.error){var e="/page/"+a.entity.entity_type_code+"/form/"+a.entity.id;window.location.replace(e)}}function postCloneRedirect(t,a){console.log(void 0!==a.entity),void 0!==a.entity&&window.location.replace("/page/"+a.entity.attribute_set_code+"/form/"+a.entity.id)}function initializeLookup(t,a){var e="",r=!1,n="simple",i="",o=t.parents(".sp-search-wrapper").length>0,s=!0,l=jQuery("body");a&&a.parents(".modal").length>0&&(l=a.parents(".modal"));var d=t.attr("readonly");return(void 0===d||!1===d)&&(t.select2({minimumInputLength:0,width:"100%",closeOnSelect:!0,dropdownParent:l,ajax:{url:t.data("search-url"),dataType:"json",quietMillis:100,type:"POST",data:function(r){e=r.term;var n={};n.q=r,n.id=t.data("id"),n.template=t.data("template"),n.form=jQuery('[data-type="'+t.parents("form").data("type")+'"] [name]').not('[data-type="ckeditor"],textarea,[data-avoid="autocomplete"],[data-multivalue="1"]').serialize();var i="",o={},s=!1;if(jQuery("body").find('[data-type="lookup"][data-single="true"]:disabled').length>0&&(jQuery("body").find('[data-type="lookup"][data-single="true"]:disabled').each(function(t){jQuery(this).val()&&(o[jQuery(this).attr("name")]=jQuery(this).val(),s=!0)}),s&&(i="&"+jQuery.param(o))),n.form=n.form+i,t.data("related")){var l=t.data("related");jQuery.each(l,function(t,e){var r=e.split(":");a.find('[name="'+r[0]+'"]').length>0&&(n[e]=a.find('[name="'+r[0]+'"]').val())})}return n},processResults:function(t,a){if(s=!0,0==t.error)return r=t.create_new,n=t.create_new_type,i=t.create_new_url,{results:jQuery.map(t.ret,function(t){return{id:t.id,text:t.html,title:jQuery(jQuery.parseHTML(t.html)).text()}})};jQuery.growl.error({title:translations.error_message,message:t.message})}},templateResult:function(t){return"<li title='"+jQuery(jQuery.parseHTML(t.html)).text()+"' data-id='"+t.id+"' class='sp-select-2-result'>"+t.text+"<li>"},escapeMarkup:function(t){return t},language:{searching:function(){return translations.searching},errorLoading:function(){return translations.searching_in_progress},noResults:function(a){return jQuery(".autocomplete-noresult-create").remove(),r&&!o?(jQuery(document).on("click",".autocomplete-noresult-create",function(a){t.off("click"),s&&(s=!1,"simple"==n?jQuery.post(t.data("search-create-url"),{attribute_id:t.data("id"),name:e},function(e){if(0==e.error){var r=new Option(e.ret.data.name,e.ret.data.id,!0,!0);t.append(r).trigger("change"),t.trigger({type:"select2:select",params:{data:e.ret.data.id}}),t.select2("close")}else jQuery.growl.error({title:translations.error_message,message:translations.there_has_been_an_error_please_try_again});a.stopImmediatePropagation(),a.preventDefault()},"json"):jQuery.post(i,{},function(a){if(0==a.error){var e=jQuery("#modal-container").clone(!0,!0).appendTo(jQuery("#page-content > div"));e.html(a.html);var r=e.find(".modal");r.modal("show");var n=r.find('[data-validate="true"]');n.initializeValidation(),jQuery("#default_modal").on("shown.bs.modal",function(t){n.forceBoostrapXs()}),n.data("callback",["modalFormAfterSave"]),n.data("parent-form-group",t.parents(".form-group").data("form-group"))}else jQuery.growl.error({title:translations.error_message,message:a.message})},"json"))}),translations.no_results_fund+".<span class='autocomplete-noresult-create pull-right' data-name='"+t.data("id")+"'>"+translations.create+"</span>"):translations.no_results_fund+"."}}}),!0)}function getUrlParameter(t,a){if(void 0===a)return!1;var e=a.split("?");if(void 0===e||!e[1])return!1;var r,n,i=(e=e[1]).split("&");for(n=0;n<i.length;n++)if((r=i[n].split("="))[0]===t)return void 0===r[1]||decodeURIComponent(r[1])}function addQueryToUrl(t,a){return t.indexOf("?")>=0?t.indexOf(a)<1&&(t=t+"&"+a):t=t+"?"+a,t}function setCookieHistory(){var t=[];if(jQuery("body").find('[data-page-type="list"]').length>0)return t.push(document.referrer),sessionStorage.setItem("history",JSON.stringify(t)),!1;var a=document.referrer;a&&(a=(a=a.split("?"))[0]),t=sessionStorage.getItem("history"),null==(t=jQuery.parseJSON(t))?(t=[]).push(document.referrer):t[t.length-1]!=a&&1!=getUrlParameter("noref",window.location.href)&&1!=getUrlParameter("noref",document.referrer)&&t.push(document.referrer),sessionStorage.setItem("history",JSON.stringify(t))}function serializeGridstack(t){var a=[];return t.children(".grid-stack-item").each(function(t){var e=jQuery(this),r={};r.id=e.attr("data-gs-id"),r.type=e.attr("data-gs-type"),r.title=e.attr("data-gs-title"),r.x=e.data("gs-x"),r.y=e.data("gs-y"),r.width=e.data("gs-width"),r.height=e.data("gs-height"),r.children=null,e.children(".grid-stack-item-content").children(".grid-stack-inner-wrapper").length>0&&(r.children=serializeGridstack(e.children(".grid-stack-item-content").children(".grid-stack-inner-wrapper").children('[data-action="grid_stack_inner"]'))),a.push(r)}),a.sort(gridstackSort),a}setCookieHistory(),jQuery.fn.extend({initializeForm:function(){var form=jQuery(this);form.find(".dropzone").length&&(Dropzone.autoDiscover=!1),form.find('[data-size="autosize"]').length>0&&form.find('[data-size="autosize"]').autosize({append:"\n"}),form.find('[data-type="multiselect"]').length>0&&form.find('[data-type="multiselect"]').multiSelect(),form.find('[data-type="ckeditor"]').length>0&&initializeCkeditor(form),form.find('[data-type="multiselect_tag"]').length>0&&form.find('[data-type="multiselect_tag"]').select2(),form.find('[data-type="bchackbox"]').length>0&&(form.find('[data-type="bchackbox"]').each(function(t){jQuery(this).bootstrapSwitch(),"view"==jQuery(this).data("form-type")&&jQuery(this).bootstrapSwitch("readonly",!0)}),jQuery('[data-type="bchackbox"]').on("switchChange.bootstrapSwitch",function(t,a){a?jQuery(this).parents(".form-group").find('[data-action="checkbox-value"]').val(1):jQuery(this).parents(".form-group").find('[data-action="checkbox-value"]').val(0)})),form.find(".sp-multiselect-wrapper").length>0&&form.find(".sp-multiselect-wrapper").each(function(t){var a=jQuery(this);a.find(".sp-sortable")&&a.find(".sp-sortable").sortable(),a.find(".sp-sortable > li").each(function(t){a.find(".sp-available").find('[data-id="'+jQuery(this).data("id")+'"]').hide()}),a.on("click",'[data-multiselect="select_all"]',function(t){a.find(".sp-available > li:visible").each(function(t){jQuery(this).trigger("click")})}),a.on("click",'[data-multiselect="deselect_all"]',function(t){a.find(".sp-sortable > li").each(function(t){jQuery(this).trigger("click")})}),a.on("click",'[data-action="remove_multiselect_item"]',function(t){if(a.find(".sp-available").find('[data-id="'+jQuery(this).data("id")+'"]').show(),jQuery(this).remove(),a.find(".sp-sortable").find("li").length<1){var e=a.find('[data-action="multiselect-validator"]');e.val(""),a.parents("form").data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)}}),a.on("click",'[data-action="add_multiselect_item"]',function(t){a.find(".sp-sortable").append('<li data-action="remove_multiselect_item" data-id="'+jQuery(this).data("id")+'"><i class="fa fa-arrows-alt"></i> '+jQuery(this).text()+"</li>");var e=a.find('[data-action="multiselect-validator"]');e.val(1),a.parents("form").data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e),jQuery(this).hide()})}),form.find(".sp-checkboxlist-wrapper").length>0&&form.find(".sp-checkboxlist-wrapper").each(function(t){var a=jQuery(this);a.on("click",'[data-checkbox-list="select_all"]',function(t){var e=a.find('[data-action="checkbox-validator"]');e.val(1),a.find(".checkbox-list input").each(function(t){jQuery(this).prop("checked",!0)}),a.parents("form").data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)}),a.on("click",'[data-checkbox-list="deselect_all"]',function(t){var e=a.find('[data-action="checkbox-validator"]');e.val(""),a.find(".checkbox-list input").each(function(t){jQuery(this).prop("checked",!1)}),a.parents("form").data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)}),a.on("click",'[data-action="checkbox-value"]',function(t){var e=a.find('[data-action="checkbox-validator"]');e.val(""),a.find(".checkbox-list input").each(function(t){jQuery(this).is(":checked")&&e.val(1)}),a.parents("form").data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)})}),form.find(".dial").length>0&&form.find(".dial").knob(),form.find('[data-type="timepicker"]:not([readonly])').length>0&&jQuery.each(form.find('[data-type="timepicker"]:not([readonly])'),function(t){initializeTimepicker(jQuery(this))}),form.find('[data-type="datesingle"]:not([readonly])').length>0&&initializeDatesingle(form.find('[data-type="datesingle"]:not([readonly])')),form.find('[data-type="datetimesingle"]:not([readonly])').length>0&&initializeDateTimesingle(form.find('[data-type="datetimesingle"]:not([readonly])')),form.find('[data-type="daterange"]:not([readonly])').length>0&&initializeDaterange(form.find('[data-type="daterange"]:not([readonly])')),form.find('[data-type="daterangetime"]:not([readonly])').length>0&&initializeDaterangeTime(form.find('[data-type="daterangetime"]:not([readonly])')),form.find('[data-action="date"][data-clear="true"]').length&&form.find('[data-action="date"][data-clear="true"]').val(""),form.find('[data-action="date"]:not([readonly])').on("cancel.daterangepicker",function(t,a){jQuery(this).val("")}),form.find('[data-action="clear-date"]').on("click",function(t){jQuery(this).siblings("input").val("").attr("value","").trigger("change")}),form.find('[data-type="base_lookup"]').length>0&&form.find('[data-type="base_lookup"]').each(function(t){var a=jQuery(this);a.select2({minimumInputLength:0,width:"100%",closeOnSelect:!0,dropdownParent:a.closest("form")});var e=a.attr("readonly");void 0!==e&&!1!==e&&a.select2({disabled:!0})}),form.find('[data-type="lookup"]').length>0&&form.find('[data-type="lookup"]').each(function(t){initializeLookup(jQuery(this),form)}),eval("typeof checkifneedscrolling === 'function'")&&checkifneedscrolling(form)},standardReload:function(){var t=jQuery(this);return jQuery('[data-table="'+t.data("type")+'"]').parents(".dataTables_wrapper").find(".datatables").DataTable().ajax.reload(null,!1),!1},redirect:function(){var t=jQuery(this).data("redirect-url");return window.location.replace(t),!1},custom:function(result){var custom_function=jQuery(this).data("custom-callback"),form=jQuery(this);return jQuery.each(custom_function,function(key,f){eval("typeof "+f+" === 'function'")&&window[f](form,result)}),!1},forceBoostrapXs:function(){var t=jQuery(this);return t.find(".sp-block-wrapper.col-sm-2").removeClass("col-sm-2").addClass("col-sm-6"),t.find(".sp-block-wrapper.col-sm-3").removeClass("col-sm-3").addClass("col-sm-6"),t.find(".sp-block-wrapper.col-sm-4").removeClass("col-sm-4").addClass("col-sm-6"),t.find(".sp-block-wrapper.col-sm-5").removeClass("col-sm-5").addClass("col-sm-6"),t.find(".sp-block-wrapper.col-sm-7").removeClass("col-sm-7").addClass("col-sm-12"),t.find(".sp-block-wrapper.col-sm-8").removeClass("col-sm-8").addClass("col-sm-12"),t.find(".sp-block-wrapper.col-sm-9").removeClass("col-sm-9").addClass("col-sm-12"),t.find(".sp-block-wrapper.col-sm-10").removeClass("col-sm-10").addClass("col-sm-12"),t.find(".sp-block-wrapper.col-sm-11").removeClass("col-sm-11").addClass("col-sm-12"),t.find(".sp-block-wrapper.col-md-2").removeClass("col-md-2").addClass("col-md-6"),t.find(".sp-block-wrapper.col-md-3").removeClass("col-md-3").addClass("col-md-6"),t.find(".sp-block-wrapper.col-md-4").removeClass("col-md-4").addClass("col-md-6"),t.find(".sp-block-wrapper.col-md-5").removeClass("col-md-5").addClass("col-md-6"),t.find(".sp-block-wrapper.col-md-7").removeClass("col-md-7").addClass("col-md-12"),t.find(".sp-block-wrapper.col-md-8").removeClass("col-md-8").addClass("col-md-12"),t.find(".sp-block-wrapper.col-md-9").removeClass("col-md-9").addClass("col-md-12"),t.find(".sp-block-wrapper.col-md-10").removeClass("col-md-10").addClass("col-md-12"),t.find(".sp-block-wrapper.col-md-11").removeClass("col-md-11").addClass("col-md-12"),t.find(".sp-block-group-wrapper > .row").each(function(t){var a=jQuery(this);if(a.find(".sp-block-wrapper").length>1){var e=0;a.find(".sp-block-wrapper").each(function(){jQuery(this).height()>e&&(e=jQuery(this).height())}),a.find(".sp-block-wrapper").css("min-height",e+"px")}}),!1},initializeValidation:function(){var form=jQuery(this);return form.initializeForm(),form.on("keyup keypress",function(t){if(13===(t.keyCode||t.which)&&!jQuery(t.target).is("textarea"))return t.preventDefault(),!1}),form.on("init.field.fv",function(t,a){var e=a.element.parents(".form-group").find('.form-control-feedback[data-fv-icon-for="'+a.field+'"]'),r=a.fv.getOptions();a.fv.getOptions(a.field).validators.notEmpty&&r.icon&&r.icon.required&&e.addClass(r.icon.required).show()}),form.formValidation({framework:"bootstrap",excluded:[":disabled",".no-icon"],icon:{required:"glyphicon glyphicon-asterisk",valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},live:"enabled",message:translations.please_fill_in_the_field_correctly,button:{selector:'button[type="submit"]'},trigger:null}).on("status.field.fv",function(t,a){var e=a.element.parents(".form-group").find('.form-control-feedback[data-fv-icon-for="'+a.field+'"]'),r=a.fv.getOptions();a.fv.getOptions(a.field).validators.notEmpty&&r.icon&&r.icon.required&&e.removeClass(r.icon.required).addClass("glyphicon")}).on("success.field.fv",function(t,a){a.fv.disableSubmitButtons(!1)}).on("err.form.fv",function(t,a){var e=jQuery(t.target).data("formValidation").getInvalidFields();jQuery(t.target).formValidation("disableSubmitButtons",!1),jQuery.growl.error({title:translations.form_error_message,message:e.length+" "+translations.invalid_fields})}).on("success.form.fv",function(e,data){if(e.preventDefault(),jQuery(".loading-bar-wrapper").show(),"undefined"!=typeof CKEDITOR)for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();var $form=jQuery(e.target),$button=$form.data("formValidation").getSubmitButton();$form.formValidation("disableSubmitButtons",!0);var fv=$form.data("formValidation");if($form.find(".sp-grid-wrapper-inner").find(".grid-stack:first").length>0){var grid=$form.find(".sp-grid-wrapper-inner").find(".grid-stack:first"),block_list=serializeGridstack(grid),res=JSON.stringify(block_list);console.log("saving grid..."),$form.find('[name="layout"]').length?$form.find('[name="layout"]').val(res):$form.find('[name="content"]').val(res)}if(form.find('[data-holder="email_template_configuration"]').length>0&&saveEmailTemplateHtmlContent(),form.data("presave")){var functions=form.data("presave");jQuery.each(functions,function(key,f){eval("typeof "+f+" === 'function'")&&window[f](form)})}var multiselect=[];form.find(".sp-multiselect-wrapper").length>0&&form.find(".sp-multiselect-wrapper").each(function(t){var a=jQuery(this),e={};e.parent_entity=jQuery(this).data("parent_entity"),e.child_entity=jQuery(this).data("child_entity"),e.link_entity=jQuery(this).data("link_entity"),e.attribute_id=jQuery(this).data("id");var r=[];a.find(".sp-sortable li").length?a.find(".sp-sortable li").each(function(t){r.push(jQuery(this).data("id"))}):a.find(".checkbox-list input").length&&a.find(".checkbox-list input:checked").each(function(t){r.push(jQuery(this).data("id"))}),e.related_ids=r,multiselect.push(e)}),form.find('[data-type="lookup"][data-multiple="true"]').length>0&&form.find('[data-type="lookup"][data-multiple="true"]').each(function(t){var a={};a.parent_entity=jQuery(this).data("parent_entity"),a.child_entity=jQuery(this).data("child_entity"),a.link_entity=jQuery(this).data("link_entity"),a.attribute_id=jQuery(this).data("id");var e=jQuery(this).val();a.related_ids=e,multiselect.push(a)});var empty_lookups="",empty_lookup_array={},empty_lookup_exists=!1;form.find('[data-type="lookup"][data-single="true"]').length>0&&(form.find('[data-type="lookup"][data-single="true"]').each(function(t){jQuery(this).val()||(empty_lookup_array[jQuery(this).attr("name")]="",empty_lookup_exists=!0)}),empty_lookup_exists&&(empty_lookups="&"+jQuery.param(empty_lookup_array)));var disabled_lookups="",disabled_lookup_array={},disabled_lookup_exists=!1;form.find('[data-type="lookup"][data-single="true"]:disabled').length>0&&(form.find('[data-type="lookup"][data-single="true"]:disabled').each(function(t){jQuery(this).val()&&(disabled_lookup_array[jQuery(this).attr("name")]=jQuery(this).val(),disabled_lookup_exists=!0)}),disabled_lookup_exists&&(disabled_lookups="&"+jQuery.param(disabled_lookup_array))),$form.find('[data-type="ckeditor"]').length>0&&$form.find('[data-type="ckeditor"]').each(function(){var t=jQuery(this);-1!=t.val().indexOf('src="data:image')&&t.val(jQuery.ckeditorConvertPastedImages(t.val()))}),jQuery.post($form.attr("action"),$form.find(":not(.inline-edit-field)").serialize()+"&"+jQuery.param({multiselect:multiselect})+empty_lookups+disabled_lookups,function(result){if($form.formValidation("disableSubmitButtons",!1),1==result.error){if(jQuery(".loading-bar-wrapper").hide(),jQuery.growl.error({title:translations.error_message,message:result.message}),form.data("callback")){var functions=form.data("callback");jQuery.each(functions,function(key,f){eval("typeof "+f+" === 'function'")&&window[f](form,result)})}}else if(0==result.error){if(jQuery(".loading-bar-wrapper").hide(),jQuery.growl.notice({title:result.title,message:result.message}),form.data("callback")){var functions=form.data("callback");jQuery.each(functions,function(key,f){eval("typeof "+f+" === 'function'")&&window[f](form,result)})}if(!$button)return!1;if($button.data("action")){var action=$button.data("action");if("close-modal"===action)$button.parents(".modal").modal("hide");else if("reload"===action)window.location=addQueryToUrl(window.location.pathname,"noref=1");else if("refresh"===action){jQuery(document).trigger("modal-close",$form);var resets=jQuery.find('[data-action="filter-reset"]');jQuery(resets).each(function(){jQuery(this).trigger("click")}),calendars&&jQuery.each(calendars,function(t,a){a.refetchEvents()}),$button.parents(".modal").modal("hide")}else{if("continue"===action){if(result.entity&&result.entity.id)if($form.find('[name="id"]').val()>0)window.location=addQueryToUrl(window.location.pathname,"noref=1");else{var url2=addQueryToUrl(window.location.pathname+"/"+String(result.entity.id)+getUrlAsAstring(),"noref=1");location.replace(url2)}return!1}if("stay"==action){if(result.entity.id&&""==form.find('[name="id"]').val()){form.find('[name="id"]').val(result.entity.id);var source_url=form.parents(".modal").data("source_url");form.parents(".modal").modal("hide"),source_url=source_url+"&id="+result.entity.id,standardAddModalForm(source_url)}return!1}if("goto"!=action)return goBackWithRefresh(e),!1;if(result.url){var url3=addQueryToUrl(result.url,"noref=1");window.location=url3}}}}else jQuery(".loading-bar-wrapper").hide(),jQuery.growl.error({title:translations.error_message,message:translations.there_has_been_an_error_please_try_again})},"json")}),form.find('[data-action="date"]').on("change",function(t){jQuery(this).siblings("i").length>0&&jQuery(this).siblings("i").hasClass("form-control-feedback")&&form.formValidation("revalidateField",jQuery(this).attr("name"))}),!1}}),jQuery(document).on("click",".sp-chart-filter",function(t){var a="/block/modal?type=filter&&block_id="+jQuery(this).data("filter-chart");""!==jQuery(this).data("page-id")&&(a=a+"&&id="+jQuery(this).data("page-id")),jQuery.post(a,{},function(t){if(0==t.error){var a=jQuery("#modal-container").clone(!0,!0).appendTo(jQuery("#page-content > div"));a.html(t.html);var e=a.find(".modal");e.modal("show");var r=e.find('[data-validate="true"]');r.initializeValidation(),jQuery("#default_modal").on("shown.bs.modal",function(t){r.forceBoostrapXs()})}else jQuery.growl.error({title:translations.error_message,message:t.message})},"json")});
